




<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Architecture — Uppy File Uploader</title>
    <meta charset="utf-8">
    <meta name="title" content="Architecture — Uppy File Uploader">
    <meta name="description" content="Sleek, modular file uploader that integrates seamlessly with any framework. It fetches files from local disk, Google Drive, Dropbox, Instagram, remote URLs, cameras and other exciting locations, and then uploads them to the final destination. It’s fast, easy to use and let&#39;s you worry about more important problems than building a file uploader.
">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@uppy_io">
    <meta name="twitter:creator" content="@uppy_io">
    <meta property="og:url" content="https://uppy.io/api/architecture/index.html">
    <meta property="og:title" content="Architecture — Uppy File Uploader">
    <meta name="twitter:title" content="Architecture — Uppy File Uploader">
    <meta name="twitter:description" content="Sleek, modular file uploader that integrates seamlessly with any framework. It fetches files from local disk, Google Drive, Dropbox, Instagram, remote URLs, cameras and other exciting locations, and then uploads them to the final destination. It’s fast, easy to use and let's you worry about more important problems than building a file uploader.
">
    <meta property="og:image" content="http://uppy.io/images/uppy-social.jpg">
    <meta name="twitter:image" content="http://uppy.io/images/uppy-social.jpg">

    <link rel="icon" href="/images/logos/uppy-dog-head-arrow.png" type="image/x-icon">
    <link rel="alternate" type="application/rss+xml" title="Uppy File Uploader" href="/atom.xml">

    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,600|Roboto+Mono" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Poiret+One:400" rel="stylesheet">
    <script>
      window.PAGE_TYPE = "api"
    </script>
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body class="page-inner">
    <div class="page">
      <header id="header" class="MainHeader js-MainHeader">
        <button class="MainHeader-menuBtn js-MenuBtn"></button>

        <a id="logo" class="MainLogo" href="/">
          <img class="MainLogo-img" src="/images/logos/uppy-dog-head-arrow.svg">
          <span class="MainLogo-text">Uppy File Uploader</span>
        </a>

        <nav>
          <ul id="nav" class="MainMenu">
            <!-- @todo uncomment search input when we get our own swifttype -->
<!-- <li>
  <form id="search-form" class="MainMenu-search">
    <input type="text" id="search-query" class="MainMenu-searchQuery st-default-search-input">
  </form>
</li> -->
<!--li><a href="/guide/" class="nav-link">Guide</a></li-->
<li><a href="/docs/" class="nav-link">Docs</a></li>
<li><a href="/examples/dashboard/" class="nav-link">Examples</a></li>
<!--li><a href="/stats/" class="nav-link">Stats</a></li-->
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li><a href="https://github.com/transloadit/uppy" class="nav-link">Github</a></li>

          </ul>
        </nav>

        <a href="https://github.com/transloadit/uppy" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#e02177; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
      </header>

      <main class="MainContent js-MainContent" id="main">
        
          
    <div class="Sidebar js-Sidebar">
  <ul class="main-menu">
    <!-- @todo uncomment search input when we get our own swifttype -->
<!-- <li>
  <form id="search-form" class="MainMenu-search">
    <input type="text" id="search-query" class="MainMenu-searchQuery st-default-search-input">
  </form>
</li> -->
<!--li><a href="/guide/" class="nav-link">Guide</a></li-->
<li><a href="/docs/" class="nav-link">Docs</a></li>
<li><a href="/examples/dashboard/" class="nav-link">Examples</a></li>
<!--li><a href="/stats/" class="nav-link">Stats</a></li-->
<li><a href="/blog/" class="nav-link">Blog</a></li>
<li><a href="https://github.com/transloadit/uppy" class="nav-link">Github</a></li>

  </ul>
  <div class="list">
    <h2>
      
        <a href="/api">API</a>
      
    </h2>
    <ul class="menu-root">
      
        
        
        
          <li>
            <a href="/api/architecture/" class="sidebar-link current">Architecture</a>
          </li>
        
      
    </ul>
    <ul class="Social">
  <li><a href="https://twitter.com/uppy_io" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @uppy_io</a></li>
  <li><iframe src="https://ghbtns.com/github-btn.html?user=transloadit&repo=uppy&type=watch&count=true"
allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe></li>
  <!-- to regenerate you can use this link: https://img.shields.io/badge/community-forum-d8006a.svg -->
  <li><a href="https://community.transloadit.com/c/uppy"><img src="/images/community-forum-d8006a.svg" /> </a></li>
  <li class="BuildBadge">
   <span class="wrapper">
     <a href="https://travis-ci.org/transloadit/uppy"><img src="https://travis-ci.org/transloadit/uppy.svg" alt="Build Status"></a>
   </span>
  </li>
  <li class="SauceBadge">
   <span class="wrapper">
     <a href="https://saucelabs.com/u/transloadit-uppy">
       <img src="https://saucelabs.com/buildstatus/transloadit-uppy" alt="Sauce Test Status"/>
     </a>
   </span>
  </li>
</ul>

  </div>
</div>


<div class="Content js-Content api with-sidebar">
    <h1>Architecture</h1>
    <p>Uppy file uploader consists of a lean <a href="https://github.com/transloadit/uppy/blob/master/src/core/Core.js" target="_blank" rel="noopener">Core</a> module and <a href="https://github.com/transloadit/uppy/tree/master/src/plugins" target="_blank" rel="noopener">Plugins</a> (see simple <a href="https://github.com/transloadit/uppy/blob/master/src/plugins/Formtag.js" target="_blank" rel="noopener">Input</a> as an example) that extend it’s functionality. Like this:</p>
<figure class="highlight js"><figcaption><span>api-usage-example.ejs</span><a href="/examples/../api-usage-example.ejs">view raw</a></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Uppy <span class="keyword">from</span> <span class="string">'uppy/lib/core'</span></span><br><span class="line"><span class="keyword">import</span> Dashboard <span class="keyword">from</span> <span class="string">'uppy/lib/plugins/Dashboard'</span></span><br><span class="line"><span class="keyword">import</span> Tus <span class="keyword">from</span> <span class="string">'uppy/lib/plugins/Tus'</span></span><br><span class="line"> </span><br><span class="line">Uppy({ <span class="attr">autoProceed</span>: <span class="literal">false</span> })</span><br><span class="line">  .use(Dashboard, { <span class="attr">trigger</span>: <span class="string">'#select-files'</span> })</span><br><span class="line">  .use(Tus, { <span class="attr">endpoint</span>: <span class="string">'https://master.tus.io/files/'</span> })</span><br><span class="line">  .run()</span><br><span class="line">  .on(<span class="string">'complete'</span>, (result) =&gt; {</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Upload result:'</span>, result)</span><br><span class="line">  })</span><br></pre></td></tr></table></figure>
<h2 id="Core"><a href="#Core" class="headerlink" title="Core"></a>Core</h2><ol>
<li><p>Core module orchestrates Uppy plugins, stores <code>state</code> with <code>files</code>, and exposes useful methods like <code>addFile</code>, <code>setState</code>, <code>upload</code> to the user and plugins. Plugins are added to Uppy with <code>.use(Plugin, opts)</code> API, like so: <code>.use(DragDrop, {target: &#39;body&#39;})</code>.</p>
</li>
<li><p>Internally Core then instantiates plugins via <code>new Plugin(this, opts)</code>, passing options to them, then places them in <code>plugins</code> object, nested by type: <code>uploader</code>, <code>progressindicator</code>, <code>acquirer</code>, etc. Core then iterates over <code>plugins</code> and calls <code>install</code> on each of them. In it’s <code>install</code> method a plugin can set event listeners to react to things happening in Uppy (upload progress, file was removed), or do anything else needed on init.</p>
</li>
<li><p>Each time <code>state</code> is updated with <code>setState(statePatch)</code>, Core runs <code>updateAll()</code> method that re-renders all of the view plugins (components) that have been mounted in the DOM somewhere, passing the new state to each of them.</p>
</li>
</ol>
<p>Core is very lean (at least we try to keep it sobe), and acts as a glue that ties together all the plugins, shared data and functionality together. It keeps <code>state</code> with <code>files</code>, <code>capabilities</code>, plus exposes a few methods that are called by plugins to update state — adding files, adding preview thumbnails to images, updating progress for each file and total progress, etc.</p>
<p><em>Comment: There is a discussion that these methods could in theory all live in Utils or be standalone modules used by plugins and the user directly, see <a href="https://github.com/transloadit/uppy/issues/116#issuecomment-247695921" target="_blank" rel="noopener">https://github.com/transloadit/uppy/issues/116#issuecomment-247695921</a>.</em></p>
<h3 id="getState"><a href="#getState" class="headerlink" title="getState()"></a>getState()</h3><p>Returns current state.</p>
<h3 id="setState-itemToUpdate-data"><a href="#setState-itemToUpdate-data" class="headerlink" title="setState({itemToUpdate: data})"></a>setState({itemToUpdate: data})</h3><p>Updates state with new state (Object.assign({}, this.state, newState)) and then runs <code>updateAll()</code>.</p>
<h3 id="updateAll"><a href="#updateAll" class="headerlink" title="updateAll()"></a>updateAll()</h3><p>Iterates over all <code>plugins</code> and runs <code>update()</code> on each of them.</p>
<h3 id="updateMeta-data-fileID"><a href="#updateMeta-data-fileID" class="headerlink" title="updateMeta(data, fileID)"></a>updateMeta(data, fileID)</h3><p>Given <code>{ size: 1200 }</code> adds that metadata to a file.</p>
<h3 id="addFile-file"><a href="#addFile-file" class="headerlink" title="addFile(file)"></a>addFile(file)</h3><p>Adds a new file to <code>state</code>. This method is used by <code>acquirer</code> plugins like Drag &amp; Drop, Webcam and Google Drive,<br>or can be called by the user on uppy instance directly: <code>uppy.addFile(myFile)</code>.</p>
<p>Normalizes that file too: tries to figure out file type by extension if mime is missing, use noname if name is missing, sets progress: 0  and so on.</p>
<h3 id="removeFile-fileID"><a href="#removeFile-fileID" class="headerlink" title="removeFile(fileID)"></a>removeFile(fileID)</h3><p>Removes file from <code>state.files</code>.</p>
<h3 id="addThumbnail-fileID"><a href="#addThumbnail-fileID" class="headerlink" title="addThumbnail(fileID)"></a>addThumbnail(fileID)</h3><p>Reads image from file’s data object in base64 and resizes that, using canvas. Then <code>state</code> is updated with a file that has thumbnail in it. Thumbnails are used for file previews by plugins like Dashboard.</p>
<h3 id="state-capabilities"><a href="#state-capabilities" class="headerlink" title="state.capabilities"></a>state.capabilities</h3><p>Core (or plugins) check and set capabilities, like: <code>resumable: true</code> (this is set by Tus Plugin), <code>touch: false</code>, <code>dragdrop: true</code>, that could possibly be used by all plugins.</p>
<h3 id="log-msg"><a href="#log-msg" class="headerlink" title="log(msg)"></a>log(msg)</h3><p>Logs stuff to console only if user specified <code>debug: true</code>, silent in production.</p>
<h3 id="core-on-‘event’-action-core-emit-‘event’"><a href="#core-on-‘event’-action-core-emit-‘event’" class="headerlink" title="core.on(‘event’, action), core.emit(‘event’)"></a>core.on(‘event’, action), core.emit(‘event’)</h3><p>An event emitter embedded into Core that is passed to Plugins, and can be used directly on the instance. Used by Plugins for communicating with other Plugins and Core.</p>
<h2 id="Events"><a href="#Events" class="headerlink" title="Events"></a>Events</h2><ul>
<li>Core listens for <code>core:upload-progress</code> event and calculates speed &amp; ETA for all files currently in progress. <em>Uploader plugins could just call core.updateProgress().</em></li>
<li>Core checks if browser in offline or online and emits <code>core:is-offline</code> or <code>core:is-online</code> that other plugins can listen to.</li>
<li>Any plugin can emit <code>informer</code> event that <code>Informer</code> plugin can use to display info bubbles. Currently only used in the Dashboard plugin. Example: <code>core.emitter.emit(&#39;informer&#39;, &#39;Connected!&#39;, &#39;success&#39;, 3000)</code>. <em>(Should this be a Core method instead of Plugin? Could be replaced by core.inform(info) method that will just update state with info)</em></li>
<li>Uploader plugins listen to <code>core:upload</code> event (can be emitted after a file has been added or when upload button has been pressed), get files via <code>core.getState().files</code>, filter those that are not marked as complete and upload them, emitting progress events.</li>
</ul>
<p><em>See discussion about Core and Event Emitter: <a href="https://github.com/transloadit/uppy/issues/116#issuecomment-247695921" target="_blank" rel="noopener">https://github.com/transloadit/uppy/issues/116#issuecomment-247695921</a></em></p>
<h2 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h2><p>Plugins extend the functionality of Core (which itself is very much barebones, does almost nothing). Plugins actually do the work — select files, modify and upload them, and show the UI.</p>
<p>Plugins that have some UI can be mounted anywhere in the dom. With current design you can have a Drag &amp; Drop area in <code>#dragdrop</code> and Progressbar in <code>body</code>. Plugins can also be mounted into other plugins that support that, like Dashboard.</p>
<p>Each plugin extends <code>Plugin</code> class with default methods that can be overridden:</p>
<h3 id="update"><a href="#update" class="headerlink" title="update()"></a>update()</h3><p>Gets called when state changes and <code>updateAll()</code> is called from Core. Checks if a DOM element (tree) has been created with a reference for it stored in plugin’s <code>this.el</code>. If so, creates a new element (tree) <code>const newEl = this.render(currentState)</code> for current plugin and then calls <code>yo.update(this.el, newEl)</code> to effectively update the existing element to match the new one (morphdom is behind that).</p>
<p>All together now:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> newEl = <span class="keyword">this</span>.render(currentState)</span><br><span class="line">yo.update(<span class="keyword">this</span>.el, newEl)</span><br></pre></td></tr></table></figure>
<h3 id="mount-target-plugin"><a href="#mount-target-plugin" class="headerlink" title="mount(target, plugin)"></a>mount(target, plugin)</h3><p>Called by the plugin itself, if it is a UI plugin that needs to do something in DOM. A <code>target</code> is passed as an argument. There are two possible scenarios for mounting:</p>
<p>1. If <code>typeof target === &#39;string&#39;</code>, then the element (tree) is rendered and gets mounted to the DOM:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.el = plugin.render(<span class="keyword">this</span>.core.state)</span><br><span class="line"><span class="built_in">document</span>.querySelector(target).appendChild(<span class="keyword">this</span>.el)</span><br></pre></td></tr></table></figure>
<p>2. If <code>typeof target === &#39;object&#39;</code>, then that plugin is found in <code>plugins</code> object of Core and <code>addTarget()</code> is called on that plugin.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> targetPlugin = <span class="keyword">this</span>.core.getPlugin(targetPluginName)</span><br><span class="line"><span class="keyword">const</span> selectorTarget = targetPlugin.addTarget(plugin)</span><br></pre></td></tr></table></figure>
<h3 id="focus"><a href="#focus" class="headerlink" title="focus()"></a>focus()</h3><p>Called when plugin is in focus, like when that plugin’s tab is selected in the Dashboard.</p>
<h3 id="install"><a href="#install" class="headerlink" title="install()"></a>install()</h3><p>Called by Core when it instantiates new plugins. In <code>install</code><br>a plugin can extend global state with its own state (like <code>{ modal: { isHidden: true } }</code>), or do anything needed on initialization, including <code>mount()</code>.</p>
<h3 id="Plugins-are-currently-of-the-following-types"><a href="#Plugins-are-currently-of-the-following-types" class="headerlink" title="Plugins are currently of the following types:"></a>Plugins are currently of the following types:</h3><h3 id="acquirer"><a href="#acquirer" class="headerlink" title="acquirer"></a>acquirer</h3><ul>
<li><strong>DragDrop</strong> — simple DragDrop, once file is dropped on a target, it gets added to state.files. “click here to select” too</li>
<li><strong>GoogleDrive</strong> — GoogleDrive UI, uses uppy-server component. Files are downloaded from Google Drive to uppy-server, without having to go through the client, saving bandwidth and space</li>
<li><strong>Formtag</strong> — simple input[type=file] element</li>
<li><strong>Webcam</strong> — allows to take pictures with your webcam, works in most browsers, except Safari. Flash (ugh) is used for fallback</li>
</ul>
<h3 id="orchestrator"><a href="#orchestrator" class="headerlink" title="orchestrator"></a>orchestrator</h3><p><em>Should probably be called UI</em></p>
<ul>
<li><strong>Dashboard</strong> — the full-featured interface for interacting with Uppy. Supports drag &amp; dropping files, provides UI for Google Drive, Webcam and any other plugin, shows selected files, shows progress on them.</li>
</ul>
<h3 id="progressindicator"><a href="#progressindicator" class="headerlink" title="progressindicator"></a>progressindicator</h3><ul>
<li><strong>ProgressBar</strong> — tiny progressbar that can be mounted anywhere.</li>
</ul>
<h3 id="uploader"><a href="#uploader" class="headerlink" title="uploader"></a>uploader</h3><ul>
<li><strong>Tus</strong> — tus resumable file uploads, see <a href="http://tus.io" target="_blank" rel="noopener">http://tus.io</a></li>
<li><strong>Multipart</strong> — regular form/multipart/xhr uploads</li>
</ul>
<h3 id="modifier"><a href="#modifier" class="headerlink" title="modifier"></a>modifier</h3><ul>
<li><strong>Metadata</strong> — allows adding custom metadata fields, data from each field is then added to a file</li>
</ul>

    
    <div class="footer">Caught a mistake or want to contribute to the documentation?
       <a href="https://github.com/transloadit/uppy/blob/master/website/src/docs/architecture.md" target="_blank">Edit/fork this page directly on Github</a>!
    </div>
</div>

        
      </main>

      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63083-12', 'uppy.io');
  ga('send', 'pageview');
</script>


      
        <script src="/js/smooth-scroll.min.js"></script>
      
      <script src="/js/common.js"></script>

      <!-- Twitter follow button script -->
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

      <!--script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
      <script>
        WebFont.load({
          google: {
            families: ['Source Sans Pro:400,600', 'Roboto Mono', 'Poiret One:400']
          }
        });
      </script-->
    </div>
  </body>
</html>
